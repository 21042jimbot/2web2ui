import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { Panel, Textfield, Table } from 'src/components/matchbox';
import { useTable } from 'src/hooks';

<Meta title="Hooks|useTable" component={Table} />

`useTable` is a generic hook for managing table state. Ideal for building dynamic, composable table
interfaces.

## Filtering

```js
function MyComponent() {
  const [state, dispatch] = useTable(DATA);

  dispatch({
    type: 'FILTER',
    filters: [
      {
        name: 'firstName', // The object key name in the target collection
        value: 'abcdefg', // The pattern by which to filter said value
      },
    ],
  });

  return (
    <>
      {state.rows.map(row => (
        <div>{row.firstName}</div>
      ))}
    </>
  );
}
```

## Sorting

```js
function MyComponent() {
  const [state, dispatch] = useTable(DATA);

  return (
    <div>
      <button
        onClick={() => {
          return dispatch({
            type: 'SORT',
            sortBy: 'firstName', // The object key name in the target collection
            direction: 'asc', // *optional* The sort direction - handled automatically when not provided
          });
        }}
      >
        Sort by First Name
      </button>

      {state.rows.map(row => (
        <div>{row.firstName}</div>
      ))}
    </div>
  );
}
```

## Full Example

```js
import React from 'react';
import { Panel, Table, TextField } from 'src/components/matchbox';
import { useTable } from 'src/hooks/useTable';

const DATA = [
  {
    firstName: 'Nick',
    lastName: 'Lemmon',
  },
  {
    firstName: 'Sparky',
    lastName: 'Sparkleson',
  },
];

function DemoComponent() {
  const [state, dispatch] = useTable(DATA);
  const [filterVal, setFilterVal] = useState('');

  useEffect(() => {
    dispatch({
      type: 'FILTER',
      filters: [{ name: 'firstName', value: filterVal }],
    });
  }, [filterVal, dispatch]);

  return (
    <Panel>
      <Panel>
        <TextField
          label="Filter By"
          onChange={e => setFilterVal(e.target.value)}
          value={filterVal}
        />
      </Panel>

      <Table>
        <thead>
          <Table.Row>
            <Table.HeaderCell>
              <Table.SortButton
                sortDirection={
                  tableState.sortBy === 'firstName' ? tableState.sortDirection : undefined
                }
                onClick={() => dispatch({ type: 'SORT', sortBy: 'firstName' })}
              >
                First Name
              </Table.SortButton>
            </Table.HeaderCell>
            <Table.HeaderCell>
              <Table.SortButton
                sortDirection={
                  tableState.sortBy === 'lastName' ? tableState.sortDirection : undefined
                }
                onClick={() => dispatch({ type: 'SORT', sortBy: 'lastName' })}
              >
                Last Name
              </Table.SortButton>
            </Table.HeaderCell>
          </Table.Row>
        </thead>
        <tbody>
          {state.rows.map((row, index) => (
            <Table.Row key={`row-${index}`}>
              <Table.Cell>{row.firstName}</Table.Cell>
              <Table.Cell>{row.lastName}</Table.Cell>
            </Table.Row>
          ))}
        </tbody>
      </Table>
    </Panel>
  );
}
```
